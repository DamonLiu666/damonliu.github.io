<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Learning Paradise</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Learning Paradise">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;index.html">
<meta property="og:site_name" content="Learning Paradise">
<meta property="article:author" content="Damon Liu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Learning Paradise" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Learning Paradise</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-SpringCloud Config" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/16/SpringCloud%20Config/" class="article-date">
  <time datetime="2020-02-16T12:17:04.020Z" itemprop="datePublished">2020-02-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/16/SpringCloud%20Config/">SpringCloud Config</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringCloud-Config-分布式配置中心"><a href="#SpringCloud-Config-分布式配置中心" class="headerlink" title="SpringCloud Config 分布式配置中心"></a>SpringCloud Config 分布式配置中心</h1><p>微服务意味着要将单个应用中的业务拆分成一个个子服务，因此系统中会出现大量的服务，每个服务自己带着一个application.yml，上百个配置文件的管理就非常麻烦。所以一套集中式的、动态的配置管理设施是必不可少的。</p>
<h2 id="1-SpringCloud-Config是什么"><a href="#1-SpringCloud-Config是什么" class="headerlink" title="1.SpringCloud Config是什么"></a>1.SpringCloud Config是什么</h2><p>SpringCloud Config为微服务架构中的服务提供集中化的外部配置支持，配置服务器为各个不同微服务应用的所有环境提供了一个中心化的外部配置。</p>
<p>SpringCloud Config分为服务端和客户端</p>
<p>服务端：分布式配置中心，是一个独立的为服务应用，用来连接配置服务器并未客户端提供获取配置信息，加密/解密信息等访问端口</p>
<p>客户端：通过指定的配置中心来管理应用资源，以及与业务相关的配置内容。并在启动的时候从配置中心获取和加载配置信息默认采用git来存储配置信息，有助于环境配置进行版本管理。</p>
<h2 id="2-SpringCloud-Config服务端配置"><a href="#2-SpringCloud-Config服务端配置" class="headerlink" title="2.SpringCloud Config服务端配置"></a>2.SpringCloud Config服务端配置</h2><ul>
<li><p>在GitHub上新建一个Repository，并获取SSH协议的git地址，本地clone</p>
</li>
<li><p>本地库新建application.yml，格式必须为UTF-8</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> </span><br><span class="line">		<span class="attr">active:</span> </span><br><span class="line">		<span class="string">-dev</span></span><br><span class="line"><span class="string">---</span>		</span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">dev</span>		<span class="comment">#开发环境</span></span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX-dev</span></span><br><span class="line"><span class="string">---</span>	</span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">test</span>		<span class="comment">#测试环境</span></span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX-test</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将yml文件push到git</p>
</li>
<li><p>在父工程目录上new一个Maven Module，Packaging选择jar</p>
</li>
<li><p>pom文件引入依赖spring-cloud-config-server。为避免config的git插件报错(org/eclipse/jgit/api/TransportConfigCallBack)，可以引入org.eclipse.jgit</p>
</li>
<li><p>配置application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line">	<span class="attr">port:</span> <span class="string">XXX</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX</span>		<span class="comment">#微服务名称</span></span><br><span class="line">	<span class="attr">cloud:</span></span><br><span class="line">		<span class="attr">config:</span> </span><br><span class="line">			<span class="attr">server:</span> </span><br><span class="line">				<span class="attr">git:</span> </span><br><span class="line">					<span class="attr">uri:</span> <span class="string">XXX</span>	<span class="comment">#GitHub上面git仓库</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>主启动类，@EnableConfigServer</p>
</li>
<li><p>windows修改hosts文件，增加映射</p>
</li>
</ul>
<h2 id="3-SpringCloud-Config客户端配置"><a href="#3-SpringCloud-Config客户端配置" class="headerlink" title="3.SpringCloud Config客户端配置"></a>3.SpringCloud Config客户端配置</h2><ul>
<li><p>在本地仓库新建client.yml文件,保存为UTF-8格式，push到git</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> </span><br><span class="line">		<span class="attr">active:</span> </span><br><span class="line">		<span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span> </span><br><span class="line">	<span class="attr">port:</span> <span class="string">XXX</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">client:</span> </span><br><span class="line">		<span class="attr">service-url:</span></span><br><span class="line">			<span class="attr">defaultZone:</span> <span class="string">XXX</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span> </span><br><span class="line">	<span class="attr">port:</span> <span class="string">XXX</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX</span></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">client:</span> </span><br><span class="line">		<span class="attr">service-url:</span></span><br><span class="line">			<span class="attr">defaultZone:</span> <span class="string">XXX</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在父工程目录上new一个Maven Module，Packaging选择jar</p>
</li>
<li><p>pom文件新增依赖spring-cloud-starter-config</p>
</li>
<li><p>在src/main/resource路径下新建文件bootstrap.yml</p>
<p>(application.yml是用户级的资源配置；bootstrap.yml是系统级的资源配置，优先级更高)</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">cloud:</span> </span><br><span class="line">		<span class="attr">config:</span> </span><br><span class="line">			<span class="attr">name:</span> <span class="string">XXX</span>	<span class="comment">#github上读取的资源名称，没有.yml后缀名</span></span><br><span class="line">			<span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">			<span class="attr">label:</span> <span class="string">master</span></span><br><span class="line">			<span class="attr">uri:</span> <span class="string">XXX</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>windows修改hosts文件，增加映射</p>
</li>
</ul>
<h2 id="4-用config配置微服务"><a href="#4-用config配置微服务" class="headerlink" title="4.用config配置微服务"></a>4.用config配置微服务</h2><ul>
<li><p>本地仓库新建yml文件，保存为UTF-8格式，push到git</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> </span><br><span class="line">		<span class="attr">active:</span> </span><br><span class="line">		<span class="bullet">-</span> <span class="string">dev</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span> </span><br><span class="line">	<span class="attr">port:</span> <span class="string">XXX</span></span><br><span class="line">	</span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">	<span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line">	<span class="attr">application:</span> </span><br><span class="line">		<span class="attr">name:</span> <span class="string">XXX</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka:</span> </span><br><span class="line">	<span class="attr">instance:</span> </span><br><span class="line">		<span class="attr">hostname:</span> <span class="string">XXX</span></span><br><span class="line">	<span class="attr">client:</span></span><br><span class="line">		<span class="attr">register-with-eureka:</span> <span class="literal">false</span>	<span class="comment">#当前eureka-server自己不注册进服务列表中</span></span><br><span class="line">		<span class="attr">fetch-registry:</span> <span class="literal">false</span>	<span class="comment">#不通过eureka获取注册信息</span></span><br><span class="line">		<span class="attr">service-url:</span> </span><br><span class="line">			<span class="attr">defaultZone:</span> <span class="string">XXX</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新建yml文件，配置provider信息，保存为UTF-8格式，push到git</p>
</li>
<li><p>在Service Provider和Eureka Server新建bootstrap.yml</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/16/SpringCloud%20Config/" data-id="ck6p0081w0000xwv176bq40rz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud Zuul" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/16/SpringCloud%20Zuul/" class="article-date">
  <time datetime="2020-02-16T12:16:57.376Z" itemprop="datePublished">2020-02-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/16/SpringCloud%20Zuul/">SpringCloud Zuul</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringCloud-Zuul路由网关"><a href="#SpringCloud-Zuul路由网关" class="headerlink" title="SpringCloud Zuul路由网关"></a>SpringCloud Zuul路由网关</h1><h2 id="1-Zuul概述"><a href="#1-Zuul概述" class="headerlink" title="1.Zuul概述"></a>1.Zuul概述</h2><p>Zuul包含了对请求的路由和过滤这两个最主要的功能：</p>
<p>​    路由：将外部请求转发到具体微服务实例上，是实现外部访问统一入口的基础。</p>
<p>​    过滤：对请求的处理过程进行干预，是实现请求校验、服务聚合等功能的基础。</p>
<p>Zuul需要注册到Eureka，以后访问微服务都是通过Zuul跳转后获得</p>
<h2 id="2-基本配置"><a href="#2-基本配置" class="headerlink" title="2.基本配置"></a>2.基本配置</h2><ul>
<li><p>在父工程目录上new一个Maven Module，Packaging选择jar</p>
</li>
<li><p>pom文件添加依赖：</p>
<p>spring-cloud-starter-eureka</p>
<p>spring-cloud-starter-zuul</p>
</li>
<li><p>配置yml</p>
<p><img src="/2020/02/16/SpringCloud%20Zuul/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CZuul01.PNG" alt="Zuul01"></p>
</li>
<li><p>修改host文件</p>
</li>
<li><p>主启动类，添加注解@EnableZuulProxy</p>
</li>
</ul>
<h2 id="3-路由访问的映射规则"><a href="#3-路由访问的映射规则" class="headerlink" title="3.路由访问的映射规则"></a>3.路由访问的映射规则</h2><ul>
<li><p>代理名称：修改yml文件,通过serviceId映射到一个path</p>
</li>
<li><p>原路径忽略：修改yml文件，设置ignored-services，可以设置为“*”，表示所有的微服务均忽略掉原路径</p>
</li>
<li><p>设置统一前缀：修改yml文件，设置prefix</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/16/SpringCloud%20Zuul/" data-id="ck6p0082b0004xwv1glm80cf8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud Hystrix" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/13/SpringCloud%20Hystrix/" class="article-date">
  <time datetime="2020-02-13T13:29:00.268Z" itemprop="datePublished">2020-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/13/SpringCloud%20Hystrix/">SpringCloud Hystrix</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringCloud-Hystrix-断路器"><a href="#SpringCloud-Hystrix-断路器" class="headerlink" title="SpringCloud Hystrix 断路器"></a>SpringCloud Hystrix 断路器</h1><h2 id="1-Hystrix是什么"><a href="#1-Hystrix是什么" class="headerlink" title="1.Hystrix是什么"></a>1.Hystrix是什么</h2><ul>
<li><p>服务雪崩</p>
<p>多个微服务之间调用的时候，假设微服务A调用微服务B和微服务C，B和C又调用其他微服务，这就是所谓的“扇出”。如果扇出的链路上某个微服务调用响应时间过长或不可用，对A的调用就会占用越来越多的资源，进而引起系统崩溃，所谓”雪崩效应”。</p>
</li>
<li><p>Hystrix是一种用于处理分布式系统延迟和容错的开源库。在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等。Hystrix能保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。</p>
</li>
<li><p>当某个服务单元发生故障之后，通过断路器的故障监控，像调用方返回一个符合预期的、可处理的备选响应(FallBack)，而不是长时间的等待或这抛出调用方无法处理的异常。</p>
</li>
</ul>
<h2 id="2-服务熔断"><a href="#2-服务熔断" class="headerlink" title="2.服务熔断"></a>2.服务熔断</h2><p>当扇出链路的某个微服务不可用或者响应时间太长，会进行服务降级，进而熔断该节点微服务的调用，快速返回“错误”的响应信息。当该节点响应正常后回复调用链路。</p>
<p>某个服务故障或异常引起的，当某个异常条件被触发，直接熔断整个服务，而不是一直等到此服务超时。</p>
<p>Hystrix会监控微服务间的调用状况，当失败的调用到一定阈值(默认5秒内20次调用失败)，则会启动熔断机制。</p>
<ul>
<li>在Service Provider pom文件新增spring-cloud-starter-hystrix依赖</li>
<li>在Service Provider Controller的方法上使用@HystrixCommand注解</li>
<li>Service Provider主启动类新增注解@EnableCircuitBreaker</li>
</ul>
<h2 id="3-服务降级"><a href="#3-服务降级" class="headerlink" title="3.服务降级"></a>3.服务降级</h2><ul>
<li><p>服务降级是什么？</p>
<p>当某个服务熔断后，服务器将不再被调用，此时客户端自己准备一个fallback回调，返回一个缺省值</p>
</li>
<li><p>服务降级处理，是在客户端处理的，与服务端无关</p>
</li>
</ul>
<p>为避免服务熔断方法膨胀，可使用如下服务降级处理</p>
<ul>
<li><p>在Service API公共模块新建一个实现了FallbackFactory接口的类</p>
<ul>
<li>一定要在这个类上使用@Component注解</li>
<li>在create方法中处理熔断</li>
</ul>
</li>
<li><p>在Service API公共模块原有的interface上修改@FeignClient注解</p>
<p>@FeignClient(value = “XXX”,fallbackFactory = YYYFallbackFactory.class)</p>
</li>
<li><p>Service API公共模块maven clean</p>
</li>
<li><p>Service API公共模块maven install</p>
</li>
<li><p>Service Consumer yml新增feign.hystrix.enable: true</p>
</li>
</ul>
<h2 id="4-Hystrix-Dashboard"><a href="#4-Hystrix-Dashboard" class="headerlink" title="4.Hystrix Dashboard"></a>4.Hystrix Dashboard</h2><ul>
<li><p>在父工程目录上new一个Maven Module，Packaging选择jar。</p>
</li>
<li><p>pom文件引入依赖</p>
<p>spring-cloud-starter-hystrix</p>
<p>spring-cloud-starter-hystrix-dashboard</p>
</li>
<li><p>yml文件配置端口</p>
</li>
<li><p>主启动类@EnableHystrixDashboard注解 </p>
</li>
<li><p>Service Provider需要引入spring-boot-starter-actuator</p>
</li>
<li><p>web访问</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">web访问地址http://ip:port/hystrix</span><br><span class="line">需要监测的地址http://ip:port/hystrix.stream</span><br></pre></td></tr></table></figure>

<p>Delay:控制服务器上轮询监控信息的延迟时间，默认2000毫秒，可以通过配置该属性来降低客户端的网络和CPU消耗</p>
<p>Title:展示自己设定的标题</p>
</li>
<li><p>七色，一圈，一线</p>
<p><img src="/2020/02/13/SpringCloud%20Hystrix/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CHystrix01.png" alt="Hystrix01"></p>
<p>七色：七种状态颜色一一对应</p>
<p>一圈(实心圆)：</p>
<ul>
<li>颜色代表健康程度。绿色-&gt;黄色-&gt;橙色-&gt;红色，健康状态依次递减</li>
<li>流量越大，实心圆越大</li>
</ul>
<p>一线:用来记录2min内流量的相对变化，可以观察流量的上升和下降趋势。</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/13/SpringCloud%20Hystrix/" data-id="ck6p0082a0003xwv1g1h9aozt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud Feign" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/13/SpringCloud%20Feign/" class="article-date">
  <time datetime="2020-02-13T13:28:55.784Z" itemprop="datePublished">2020-02-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/13/SpringCloud%20Feign/">SpringCloud Feign</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Feign负载均衡"><a href="#Feign负载均衡" class="headerlink" title="Feign负载均衡"></a>Feign负载均衡</h1><h2 id="1-Feign是什么"><a href="#1-Feign是什么" class="headerlink" title="1.Feign是什么"></a>1.Feign是什么</h2><p>是一个声明式的Web服务客户端，使编写Web服务客户端变得非常容易。</p>
<p>只需要创建一个接口，然后在上面添加注解即可。</p>
<p>在使用Ribbon+RestTemplate时，利用RestTemplate对http请求的封装处理，形成了一套模板化的调用方法。但实际开发中，一个接口可能会被多处调用，所以通常会针对每个微服务自行封装一些客户端类来包装这些依赖服务的调用。所以，Feign在此基础上做了封装，帮助我们定义和实现依赖服务接口的定义。简化使用Ribbon时，自动封装服务调用客户端的开发量。</p>
<p>Feign集成了Ribbon，利用Ribbon维护了服务列表信息，并通过轮询实现了客户端的负载均衡，而与Ribbon不同的时，通过Feign只需要定义服务绑定接口且以声明式的方法，优雅而简单的实现了服务调用</p>
<h2 id="2-Feign的构建步骤"><a href="#2-Feign的构建步骤" class="headerlink" title="2.Feign的构建步骤"></a>2.Feign的构建步骤</h2><ul>
<li>在父工程目录上new一个Maven Module，Packaging选择jar，新建一个Consumer工程</li>
<li>pom文件新增spring-cloud-starter-feign依赖</li>
<li>修改Service API公共模块<ul>
<li>pom文件新增spring-cloud-starter-feign依赖</li>
<li>新建interface接口，用@FeignClient注解</li>
<li>maven clean</li>
<li>maven install</li>
</ul>
</li>
<li>Feign Consumer的Controller不再使用RestTemplate，改为引入API公共模块的interface</li>
<li>在Feign Consumer的主启动类新增注解@EnableFeignClients，@ComponentScan</li>
<li>先启动3个Eureka服务，再启动3个Provider服务，最后启动Service Feign</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/13/SpringCloud%20Feign/" data-id="ck6p0082e0007xwv14yb97tcj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud Ribbon" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/11/SpringCloud%20Ribbon/" class="article-date">
  <time datetime="2020-02-11T10:16:01.744Z" itemprop="datePublished">2020-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/11/SpringCloud%20Ribbon/">SpringCloud Ribbon</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringCloud-Ribbon-负载均衡"><a href="#SpringCloud-Ribbon-负载均衡" class="headerlink" title="SpringCloud Ribbon 负载均衡"></a>SpringCloud Ribbon 负载均衡</h1><h2 id="1-Ribbon是什么"><a href="#1-Ribbon是什么" class="headerlink" title="1.Ribbon是什么"></a>1.Ribbon是什么</h2><p>是基于Netflix Ribbon实现的一套客户端的负载均衡工具。</p>
<p>Ribbon客户端提供一系列完善的配置项如连接超时，重试等。简单地说，就是再配置文件中列出Load Balance(简称LB)后面所有的机器，Ribbon会自动基于某种规则(如简单轮询，随机连接等)去连接这些机器。我们也很容易使用Ribbon实现自定义的负载均衡算法。</p>
<p>LB，即负载均衡(Load Balance)，在为服务或分布式急群众常用的一种应用。</p>
<p>负载均衡简单的说就是将用户的请求平摊的分配到多个服务上，从而达到系统的HA(高可用)。</p>
<p>常见的负载均衡有软件Nginx，LVS，硬件F5等。</p>
<p>在dubbo和SpringCloud中均提供了负载均衡，SpringCloud的负载均衡算法可以自定义。</p>
<p>集中式LB：在服务的消费方和提供方之间使用独立的LB设施(可以是硬件，如F5，也可以是软件，如Nginx)，由该设施负责将访问请求通过某种策略转发到服务提供方。</p>
<p>进程内LB：将LB逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，然后自己再从这些地址中选择出一个合适的服务器。</p>
<p>Ribbon就数据进程内LB，它是一个类库，继承与消费方进程，消费方通过它来获取到服务提供方的地址。</p>
<h2 id="2-Ribbon初步配置"><a href="#2-Ribbon初步配置" class="headerlink" title="2.Ribbon初步配置"></a>2.Ribbon初步配置</h2><ul>
<li><p>Service Consumer工程pom文件新增依赖</p>
<p>spring-cloud-starter-eureka</p>
<p>spring-cloud-starter-config</p>
<p>spring-cloud-starter-ribbon</p>
</li>
<li><p>Service Consumer 修改application.yml</p>
<p><img src="/2020/02/11/SpringCloud%20Ribbon/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CRibbon01.PNG" alt="Ribbon01"></p>
</li>
<li><p>Service Consumer ConfigBean中获取RestTemplate新增@LoadBalanced注解</p>
<p><img src="/2020/02/11/SpringCloud%20Ribbon/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CRibbon02.PNG" alt="Ribbon02"></p>
</li>
<li><p>Service Consumer 主启动类新增@EnableEurekaClient注解</p>
</li>
<li><p>Service Consumer Controller中修改访问地址为微服务名称</p>
</li>
<li><p>先启动3个Eureka集群，再启动Provider注册进Eureka，最后启动Consumer</p>
</li>
</ul>
<p>Ribbon和Eureka整合后，Consumer可以字节调用服务，而不用再关心地址和端口号</p>
<h2 id="3-Ribbon负载均衡"><a href="#3-Ribbon负载均衡" class="headerlink" title="3.Ribbon负载均衡"></a>3.Ribbon负载均衡</h2><ul>
<li><p>再新建两个Service Provider，配置对应的pom，application.yml</p>
<p>这两个Provider可以连接其他的数据库</p>
<p>三个Provider对外暴露的服务名要保持一致</p>
</li>
<li><p>先启动3个Eureka集群，再启动3个Provider，最后启动Consumer</p>
</li>
</ul>
<h2 id="4-Ribbon核心组件IRule"><a href="#4-Ribbon核心组件IRule" class="headerlink" title="4.Ribbon核心组件IRule"></a>4.Ribbon核心组件IRule</h2><p>根据特定算法从服务列表中选取一个要访问的服务。</p>
<p>在Serevice Consumer中新增方法，用@Bean注解。</p>
<p>例如改为随机算法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> IRule <span class="title">myRule</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RandomRule();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>RoundRobinRule轮询(默认)</li>
<li>RandomRule 随机</li>
<li>AvaliablityFilteringRule优先过滤掉由于多次访问故障而处于断路器跳闸状态的服务和并发出超级阈值的服务，然后对剩余的服务轮询</li>
<li>WeightedResponseTimeRule根据平均响应时间计算所有服务的权重，响应时间越快，权重越大，被选中概率越高。刚启动时统计信息不足，会先使用轮询，等到统计信息足够再切换过来</li>
<li>RetryRule先按照轮询，如果获取服务失败，会进行重试，在一定时间之后，只会获取其他可用的服务</li>
<li>BestAvailableRule优先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，然后选择一个并发量小的服务</li>
<li>ZoneAvoidanceRule符合判断server所在区域的性能和server的可用性选择服务器</li>
</ul>
<h2 id="5-Ribbon自定义"><a href="#5-Ribbon自定义" class="headerlink" title="5.Ribbon自定义"></a>5.Ribbon自定义</h2><ul>
<li><p>Service Consumer主启动类添加注解@RibbonClient</p>
<p>再启动微服务的时候能自动加载我们自定义的Ribbon配置类</p>
</li>
<li><p>自定义配置类不能放在@ComponentScan所扫描的当前包及子包下(不能在主启动类所在的包下)，否则这个配置类会被所有Ribbon客户端共享，达不到定制化目的。</p>
</li>
<li><p>算法extends AbstrctLoadBalancerRule</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/11/SpringCloud%20Ribbon/" data-id="ck6p0082c0005xwv15m1cdppo" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud Eureka" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/10/SpringCloud%20Eureka/" class="article-date">
  <time datetime="2020-02-10T11:28:24.734Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/10/SpringCloud%20Eureka/">SpringCloud Eureka</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="服务注册与发现-Eureka"><a href="#服务注册与发现-Eureka" class="headerlink" title="服务注册与发现 Eureka"></a>服务注册与发现 Eureka</h1><h2 id="1-Eureka是什么"><a href="#1-Eureka是什么" class="headerlink" title="1.Eureka是什么"></a>1.Eureka是什么</h2><p>Eureka是Netflix的一个子模块。</p>
<p>是基于Rest的服务，用于定位服务，以实现云端中间层服务发现和故障转移。</p>
<p>有了服务发现与注册，只需要使用服务的标识符，就可以访问到服务，而不需要修改服务调用的配置文件了。</p>
<p>功能类似于dubbo的注册中心，比如Zookeeper。</p>
<h2 id="2-Eureka基本架构"><a href="#2-Eureka基本架构" class="headerlink" title="2.Eureka基本架构"></a>2.Eureka基本架构</h2><p>采用C - S的设计架构。Eureka Server作为服务注册功能的服务器，是服务注册中心。</p>
<p>系统中的其他微服务，使用Eureka Client端连接到Eureka Server并维持心跳连接。</p>
<p>系统维护人员可以通过Eureka Server来监控各个微服务是否正常运行。</p>
<p>Spring Cloud的其他模块(比如Zuul)就可以通过Eureka Server来发现系统中其他微服务，并执行相关的逻辑。</p>
<p>Eureka Client是一个Java客户端，用于简化Eureka Server的交互，同时也具备一个内置的、使用轮询(dound-robin)堵在算法的负载均衡器。在容器移动后，将会像Eureka Server发送心跳(默认周期30s)。如果Eureka Server在多个心跳周期内没有收到某个节点的心跳。Eureka Server将会从服务注册表中把这个服务节点移除(默认90s)</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka%E6%9E%B6%E6%9E%84.PNG" alt="Eureka架构"></p>
<h2 id="3-Eureka三大角色"><a href="#3-Eureka三大角色" class="headerlink" title="3.Eureka三大角色"></a>3.Eureka三大角色</h2><ul>
<li>Eureka Server提供服务注册和发现</li>
<li>Service Provider将自身服务注册到Eureka，从而使服务消费放能够找到</li>
<li>Service Consumer从Eureka获取注册服务列表，从而消费服务</li>
</ul>
<h2 id="4-构建步骤"><a href="#4-构建步骤" class="headerlink" title="4.构建步骤"></a>4.构建步骤</h2><ul>
<li><p>在父工程目录上new一个Maven Module，Packaging选择jar。做为Eureka Server。</p>
<ul>
<li><p>pom文件引入spring-cloud-starter-euraka-server依赖</p>
</li>
<li><p>src/mian/resource路径下配置application.yml</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka_yml.PNG" alt="Eureka_yml"></p>
</li>
<li><p>Eureka Server主启动类  </p>
<p>@SpringBootApplication</p>
<p>@EnableEurekaServer(EurekaServer启动类，接受其他微服务注册进来)</p>
</li>
</ul>
</li>
<li><p>将Service Provider注册到Eureka Server。</p>
<ul>
<li><p>在Service Provider pom文件引入依赖:</p>
<p>spring-cloud-starter-eureka</p>
<p>spring-cloud-starter-config</p>
</li>
<li><p>修改Service Provider application.yml</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka_client_yml.PNG" alt="Eureka_client_yml"></p>
</li>
<li><p>修改Service Provider主启动类</p>
<p>@EnableEurekaClient(服务启动后会自动注册到Eureka)</p>
</li>
</ul>
</li>
<li><p>actuator与注册微服务信息完善</p>
<ul>
<li><p>主机名称：服务名称修改</p>
<p>修改Service Peovider application.yml</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka_client_yml01.PNG" alt="Eureka_client_yml01"></p>
</li>
<li><p>访问信息有IP信息提示</p>
<p>修改Service Peovider application.yml</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581324558809.png" alt="1581324558809"></p>
</li>
<li><p>微服务info内容详细信息</p>
<p>在Service Provider pom文件新增spring-boot-starter-actuator依赖</p>
<p>在父工程pom文件新增构建信息</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581325162322.png" alt="1581325162322"></p>
<p>修改Service Peovider application.yml</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka_client_yml02.PNG" alt="Eureka_client_yml02"></p>
</li>
</ul>
</li>
<li><p>Eureka自我保护机制</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581327793296.png" alt="1581327793296"></p>
<p>某时刻某一个微服务不可用了，eureka不会立即清理，依旧会对该微服务的信息进行保存。(防止由于网络原因引起的连接问题，体现出了Eureka的高可用和可容错)</p>
<p>在Eureka Server的yml文件中配置eureka.server.enable-self-preservation: false可以禁用自我保护机制，但不建议此操作。</p>
</li>
<li><p>服务发现</p>
<p>对于注册到Eureka的微服务，可以通过服务发现来获得该服务的信息</p>
<ul>
<li><p>在Service Provider 的controller新增DiscoveryClient API</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka_discovery.png" alt="Eureka_discovery"></p>
</li>
<li><p>在Service Provider 的主启动类新增注解@EnableDiscoveryClient(服务发现)</p>
</li>
<li><p>在Service Consumer 的Controller新增discovery API<img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CDesktop%5C%E5%BE%AE%E6%9C%8D%E5%8A%A1%5CEureka_discovery_consumer.png" alt="Eureka_discovery_consumer"></p>
</li>
</ul>
</li>
</ul>
<h2 id="5-Eureka集群配置"><a href="#5-Eureka集群配置" class="headerlink" title="5.Eureka集群配置"></a>5.Eureka集群配置</h2><ul>
<li><p>在父工程目录上new两个Maven Module，Packaging选择jar</p>
</li>
<li><p>pom文件引入相同的依赖</p>
</li>
<li><p>建立主启动类</p>
</li>
<li><p>修改映射配置文件</p>
<p>windows下找到C:\Windows\System32\drivers\etc下的host文件添加如下内容：</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581331304637.png" alt="1581331304637"></p>
</li>
<li><p>三个Eureka Server配置yml，修改hostname和defaultZone</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581331551233.png" alt="1581331551233"></p>
</li>
<li><p>修改Service Provider 的yml，将三台Eureka Server的地址添加到defaultZone</p>
</li>
<li><p>测试</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581331934733.png" alt="1581331934733"></p>
</li>
</ul>
<h2 id="6-作为服务注册中心，Eureka对比Zookeeper的优势"><a href="#6-作为服务注册中心，Eureka对比Zookeeper的优势" class="headerlink" title="6.作为服务注册中心，Eureka对比Zookeeper的优势"></a>6.作为服务注册中心，Eureka对比Zookeeper的优势</h2><ul>
<li><p>Zookeeper遵守CP</p>
<p>当zk的master节点一位内网络故障和其他节点失去联系时，剩余节点会重新进行leader选举，但这个时间比较长(30s~120s)，在此期间zk集群是不可用的，注册服务会瘫痪。</p>
</li>
</ul>
<ul>
<li><p>Eureka 遵守AP</p>
<p>只要有一台Eureka还在，就能保证服务可用(高可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。</p>
<p>Eureka还有自我保护机制，如果在15min内85%的节点没有正常心跳，那么Eureka会认为和不断与注册中心出现网络故障，会出现以下几种情况：</p>
<p>1.Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务</p>
<p>2.Eureka依然能够接受新服务的注册和查询请求，但不会被同步到其他节点上(保证当前节点依然可用)</p>
<p>3.当网络稳定后，当前实例心的注册信息会被同步到其他节点中</p>
</li>
</ul>
<p>补充：</p>
<p>RDBMS(MySQL/Oracle/sqlServer)  —-&gt; ACID(原子性、一致性、隔离性、持久性)</p>
<p>NOSQL(redis/mongdb) —-&gt; CAP(强一致性、高可用性、分区容错性)</p>
<p><img src="/2020/02/10/SpringCloud%20Eureka/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1581332583650.png" alt="1581332583650"></p>
<p>在分布式系统中，肯定存在由于网络或硬件导致的延迟丢包问题，所以，分区容错性(P)必须实现。故只能在A和C中二选一</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/10/SpringCloud%20Eureka/" data-id="ck6p008290002xwv1691gc82p" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud微服务工程构建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/10/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/" class="article-date">
  <time datetime="2020-02-10T11:28:20.665Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/10/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/">SpringCloud微服务工程构建</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringCloud微服务工程构建"><a href="#SpringCloud微服务工程构建" class="headerlink" title="SpringCloud微服务工程构建"></a>SpringCloud微服务工程构建</h1><h2 id="1-父工程构建"><a href="#1-父工程构建" class="headerlink" title="1.父工程构建"></a>1.父工程构建</h2><ul>
<li><p>new 一个Maven Project，Packaging选择pom。</p>
<p>主要是定义pom文件，将后续各个子模块公用的jar包统一提取出来，类似于一个抽象父类</p>
</li>
</ul>
<h2 id="2-API公共模块构建"><a href="#2-API公共模块构建" class="headerlink" title="2.API公共模块构建"></a>2.API公共模块构建</h2><ul>
<li><p>在父工程目录上new一个Maven Module，Packaging选择jar。</p>
<p>此时父工程pom文件中会出现公共模块</p>
</li>
<li><p>在公共模块的pom文件中按需添加依赖</p>
</li>
<li><p>公共模块功能实现</p>
</li>
<li><p>maven clean</p>
</li>
<li><p>maven install</p>
</li>
</ul>
<p>在公共模块中可以定义公用的实体类，由于微服务每个模块可以使用不同的数据库，所以在定义实体类时，可以定义一个String字段用来和数据库名称对应。</p>
<p>实体类建立：</p>
<ul>
<li>pom文件添加lombok依赖</li>
<li>实体类 implements Serializable    必须序列化</li>
<li>@AllArgsConstructor    全参构造方法</li>
<li>@NoArgsConstructor    空参构造方法</li>
<li>@Data    setter 和 getter 方法</li>
<li>@Accessors(chain = true)    链式风格</li>
</ul>
<h2 id="3-Provider工程构建"><a href="#3-Provider工程构建" class="headerlink" title="3.Provider工程构建"></a>3.Provider工程构建</h2><ul>
<li>在父工程目录上new一个Maven Module，Packaging选择jar</li>
<li>pom文件引入API公共模块及需要的依赖</li>
<li>src/mian/resource路径下配置application.yml<ul>
<li>server port</li>
<li>mybatis整合(config路径，entity路径，mapper路径)</li>
<li>spring整合(name,datasource)</li>
</ul>
</li>
<li>src/mian/resource路径下新建mybatis文件夹，配置mybatis.cfg.xml文件<ul>
<li>开启二级缓存</li>
</ul>
</li>
<li>mysql 数据库脚本(建表)</li>
<li>Dao层，@Mapper注解</li>
<li>src/mian/resource/mybatis路径下新建mapper文件夹，新建与dao对应的xml文件</li>
<li>Service 接口</li>
<li>ServiceImpl 实现类，@Service注解</li>
<li>Controller 提供REST，@RestController注解</li>
<li>服务主启动类</li>
</ul>
<h2 id="4-Consumer工程构建"><a href="#4-Consumer工程构建" class="headerlink" title="4.Consumer工程构建"></a>4.Consumer工程构建</h2><ul>
<li>在父工程目录上new一个Maven Module，Packaging选择jar</li>
<li>pom文件引入API公共模块及需要的依赖</li>
<li>src/mian/resource路径下配置application.yml<ul>
<li>server port</li>
</ul>
</li>
<li>在工程目录下新建文件夹cfgbeans，新建ConfigBean.java，@Configuration注解<ul>
<li>getRestTemplate()，返回RestTemplate，用@Bean注解。</li>
</ul>
</li>
<li>Controller，使用RestTemplate调用对应方法返回</li>
<li>服务主启动类</li>
</ul>
<p>RestTemplate：</p>
<p>提供了多种便捷访问远程Http服务的方法，</p>
<p>是一种简单便捷的访问restful服务模块类，是Spring提供的用于访问Rest服务的客户端模板工具集。</p>
<p>(url，requestMap，ResponseBean.class)这三个参数分别代表：REST请求地址，请求参数，HTTP响应被转换成的对象类型</p>
<h2 id="5-测试"><a href="#5-测试" class="headerlink" title="5.测试"></a>5.测试</h2><ul>
<li>启动Provider和Consumer工程</li>
<li>使用Consumer工程URL访问，查看结果</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/10/SpringCloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%B7%A5%E7%A8%8B%E6%9E%84%E5%BB%BA/" data-id="ck6p0082t0008xwv18zxccm2t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringCloud概述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/10/SpringCloud%E6%A6%82%E8%BF%B0/" class="article-date">
  <time datetime="2020-02-10T11:28:17.104Z" itemprop="datePublished">2020-02-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/10/SpringCloud%E6%A6%82%E8%BF%B0/">SpringCloud概述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="SpringCloud-概述"><a href="#SpringCloud-概述" class="headerlink" title="SpringCloud 概述"></a>SpringCloud 概述</h1><h2 id="1-SpringCloud和SpringBoot的关系"><a href="#1-SpringCloud和SpringBoot的关系" class="headerlink" title="1.SpringCloud和SpringBoot的关系"></a>1.SpringCloud和SpringBoot的关系</h2><ul>
<li>SpringBoot关注于快速便捷的开发单个个体微服务</li>
<li>SpringCloud是关注于全局的微服务协调整理治理框架，将SpringBoot开发的一个个单体微服务整合并管理起来</li>
<li>springBoot可以离开SpringCloud独立开发项目，反之不可，是依赖关系</li>
</ul>
<h2 id="2-SpringClooud和Dubbo对比"><a href="#2-SpringClooud和Dubbo对比" class="headerlink" title="2.SpringClooud和Dubbo对比"></a>2.SpringClooud和Dubbo对比</h2><table>
<thead>
<tr>
<th></th>
<th>Dubbo</th>
<th>SpringCloud</th>
</tr>
</thead>
<tbody><tr>
<td>服务注册中心</td>
<td>Zookeeper</td>
<td>Spring Cloud  Netflix Eureka</td>
</tr>
<tr>
<td>服务调用方式</td>
<td>RPC</td>
<td>Rest API</td>
</tr>
<tr>
<td>服务监控</td>
<td>Dubbo-monitor</td>
<td>Spring Boot Admin</td>
</tr>
<tr>
<td>断路器</td>
<td>不完善</td>
<td>Spring Cloud Netflix Hystrix</td>
</tr>
<tr>
<td>服务网关</td>
<td>无</td>
<td>Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td>分布式配置</td>
<td>无</td>
<td>Spring Cloud Config</td>
</tr>
<tr>
<td>服务跟踪</td>
<td>无</td>
<td>Spring Cloud Sleuth</td>
</tr>
<tr>
<td>消息总线</td>
<td>无</td>
<td>Spring Cloud Bus</td>
</tr>
<tr>
<td>数据流</td>
<td>无</td>
<td>Spring Cloud Stream</td>
</tr>
<tr>
<td>批量任务</td>
<td>无</td>
<td>Spring Cloud Task</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/10/SpringCloud%E6%A6%82%E8%BF%B0/" data-id="ck6p0083j000cxwv1ethx5f1r" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-微服务概述" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0/" class="article-date">
  <time datetime="2020-02-06T14:14:50.562Z" itemprop="datePublished">2020-02-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0/">微服务概述</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="微服务概述"><a href="#微服务概述" class="headerlink" title="微服务概述"></a>微服务概述</h1><h2 id="1-什么是微服务架构"><a href="#1-什么是微服务架构" class="headerlink" title="1.什么是微服务架构"></a>1.什么是微服务架构</h2><ul>
<li>微服务架构是一种架构模式或者说是一种架构风格</li>
<li>将单一应用程序按业务划分成一组小的服务，每个服务运行在其独立的进程中。服务之间互相调用、配合，为用户提供最终价值</li>
<li>服务之间采用轻量级的通信机制进行沟通(通常是基于HTTP的RESTful API)</li>
<li>每个服务独立部署、发布</li>
</ul>
<h2 id="2-什么是微服务"><a href="#2-什么是微服务" class="headerlink" title="2.什么是微服务"></a>2.什么是微服务</h2><ul>
<li><p>强调的是服务的大小，每个服务个体完成一个具体的任务或功能</p>
<p>狭义的可以理解为是eclipse里的一个个工程</p>
</li>
</ul>
<h2 id="3-微服务优缺点"><a href="#3-微服务优缺点" class="headerlink" title="3.微服务优缺点"></a>3.微服务优缺点</h2><ul>
<li>优点<ul>
<li>每个服务足够小，代码容易理解。每个服务能聚焦一个指定的业务功能或业务需求</li>
<li>易于被小团队开发、修改和维护</li>
<li>松耦合，是有功能意义的服务，无论是在开发阶段还是部署阶段都是独立的</li>
<li>微服务能使用不同的语言开发</li>
<li>易于和第三方集成，允许容易且灵活的方式集成自动部署，通过持续集成工具，如Jenkins</li>
<li>只是业务逻辑的代码，不会和HTML、CSS或其他页面组件混合</li>
<li>每个微服务可以使用自己独立的数据库，也可以共用一个数据库</li>
</ul>
</li>
<li>缺点<ul>
<li>需要处理分布式系统的复杂性</li>
<li>多服务运维难度增加</li>
<li>系统部署依赖</li>
<li>服务间有通信成本</li>
<li>数据一致性</li>
<li>系统集成测试麻烦</li>
<li>性能监控复杂</li>
</ul>
</li>
</ul>
<h2 id="4-微服务技术栈"><a href="#4-微服务技术栈" class="headerlink" title="4.微服务技术栈"></a>4.微服务技术栈</h2><table>
<thead>
<tr>
<th>微服务条目</th>
<th>落地技术</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>服务开发</td>
<td>SpringBoot、Spring、SpringMVC</td>
<td></td>
</tr>
<tr>
<td>服务配置与管理</td>
<td>Netflix公司的Archaius、阿里的Diamond等</td>
<td></td>
</tr>
<tr>
<td>服务注册与发现</td>
<td>Eureka、Consul、Zookeeper</td>
<td></td>
</tr>
<tr>
<td>服务调用</td>
<td>Rest、RPC、gRPC</td>
<td></td>
</tr>
<tr>
<td>服务熔断器</td>
<td>Hystrix、Envoy</td>
<td></td>
</tr>
<tr>
<td>负载均衡</td>
<td>Ribbon、Nginx</td>
<td></td>
</tr>
<tr>
<td>服务接口调用(客户端调用服务的简化工具)</td>
<td>Feign</td>
<td></td>
</tr>
<tr>
<td>消息队列</td>
<td>Kafka、RabbitMQ、ActiveMQ</td>
<td></td>
</tr>
<tr>
<td>服务配置中心管理</td>
<td>SpringCloudConfig、Chef</td>
<td></td>
</tr>
<tr>
<td>服务路由(API网关)</td>
<td>Zuul</td>
<td></td>
</tr>
<tr>
<td>服务监控</td>
<td>Zabbix、Nagios、Metrics、Spectator</td>
<td></td>
</tr>
<tr>
<td>全链路追踪</td>
<td>Zipkin、Brave、Dapper</td>
<td></td>
</tr>
<tr>
<td>服务部署</td>
<td>Docker、OpenStack、K8S</td>
<td></td>
</tr>
<tr>
<td>数据流操作开发包</td>
<td>SpringCloud Stream(封装Redis、Rabbit、Kafka等发送接收消息)</td>
<td></td>
</tr>
<tr>
<td>事件消息总线</td>
<td>SpringCloud Bus</td>
<td></td>
</tr>
</tbody></table>
<h2 id="5-各微服务框架对比"><a href="#5-各微服务框架对比" class="headerlink" title="5.各微服务框架对比"></a>5.各微服务框架对比</h2><table>
<thead>
<tr>
<th>功能点/服务框架</th>
<th>Spring Cloud</th>
<th>Motan</th>
<th>gRPC</th>
<th>Thrift</th>
<th>Dubbo</th>
</tr>
</thead>
<tbody><tr>
<td>功能定位</td>
<td>完整的微服务框架</td>
<td>RPC框架，但整合了ZK或Consul，实现集群环境的基本服务注册和发现</td>
<td>RPC框架</td>
<td>RPC框架</td>
<td>RPC框架</td>
</tr>
<tr>
<td>支持Rest</td>
<td>是，Ribbon支持多种可插拔的序列化选择</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>支持RPC</td>
<td>否</td>
<td>是</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>支持多语言</td>
<td>是</td>
<td>否</td>
<td>是</td>
<td>是</td>
<td>是</td>
</tr>
<tr>
<td>服务注册/发现</td>
<td>是(Eureka)   Eureka服务注册表，Karyon服务端框架支持服务自注册和健康检查</td>
<td>是(Zookeeper/Consul)</td>
<td>否</td>
<td>否</td>
<td>是</td>
</tr>
<tr>
<td>负载均衡</td>
<td>是(服务端Zuul+客户端Ribbon)</td>
<td>是(客户端)</td>
<td>否</td>
<td>否</td>
<td>是(客户端)</td>
</tr>
<tr>
<td>配置服务</td>
<td>Netflix Archaius  SpringCloud Config Server集中配置</td>
<td>是(Zookeeper提供)</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>服务调用链监控</td>
<td>是(Zuul)  Zuul提供边缘服务，API网关</td>
<td>否</td>
<td>否</td>
<td>否</td>
<td>否</td>
</tr>
<tr>
<td>高可用/容错</td>
<td>是(服务端Hystrix+客户端Ribbon)</td>
<td>是(客户端)</td>
<td>否</td>
<td>否</td>
<td>是(客户端)</td>
</tr>
<tr>
<td>典型应用案例</td>
<td>Netflix</td>
<td>Sina</td>
<td>Google</td>
<td>Facebook</td>
<td></td>
</tr>
<tr>
<td>其他</td>
<td>Spring Cloud Bus为我们的应用程序带来了更多的管理端点</td>
<td>支持降级</td>
<td>Netflix内部开发集成gRPC</td>
<td>IDL定义</td>
<td></td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/02/06/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A6%82%E8%BF%B0/" data-id="ck6p0082w000axwv1a54d3vc9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Docker常用操作" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2020-01-06T12:58:29.733Z" itemprop="datePublished">2020-01-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/">Docker常用操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Docker-常用操作"><a href="#Docker-常用操作" class="headerlink" title="Docker 常用操作"></a>Docker 常用操作</h1><h2 id="1-安装镜像"><a href="#1-安装镜像" class="headerlink" title="1.安装镜像"></a>1.安装镜像</h2><p>以mysql为例</p>
<h3 id="查询镜像"><a href="#查询镜像" class="headerlink" title="查询镜像"></a>查询镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1577711432781.png" alt="1577711432781"></p>
<p>注意：OFFICIAL这一栏位带有“OK”的，是官方镜像</p>
<h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure>

<p>此时下载的是latest版本的镜像</p>
<h3 id="拉取指定版本的镜像"><a href="#拉取指定版本的镜像" class="headerlink" title="拉取指定版本的镜像"></a>拉取指定版本的镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.5</span><br></pre></td></tr></table></figure>

<p>拉取指定版本的镜像，需要带上对应的tag</p>
<p>tag可以到docker hub 查找( <a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a> )</p>
<h3 id="查看安装好的镜像"><a href="#查看安装好的镜像" class="headerlink" title="查看安装好的镜像"></a>查看安装好的镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1577715029994.png" alt="1577715029994"></p>
<h3 id="删除docker-镜像"><a href="#删除docker-镜像" class="headerlink" title="删除docker 镜像"></a>删除docker 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi XXX</span><br></pre></td></tr></table></figure>

<p>删除的时候，需带上对应的image id</p>
<h2 id="2-容器操作"><a href="#2-容器操作" class="headerlink" title="2.容器操作"></a>2.容器操作</h2><p>软件镜像—-&gt;运行镜像—-&gt;产生一个容器(正在运行的软件)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.搜索镜像</span><br><span class="line">	docker search tomcat</span><br><span class="line">2.拉取镜像</span><br><span class="line">	docker pull tomcat</span><br><span class="line">3.启动容器</span><br><span class="line">	docker run --name mytomcat -d tomcat:latest</span><br><span class="line">	(--name后面的名称自己取；	-d 表示后台运行)</span><br><span class="line">4.查看运行的容器</span><br><span class="line">	docker ps</span><br><span class="line">5.停止正在运行的容器</span><br><span class="line">	docker stop mytomcat</span><br><span class="line">6.查看所有的容器(包括运行中的和已停止的)</span><br><span class="line">	docker ps -a</span><br><span class="line">7.重新启动容器</span><br><span class="line">	docker start 容器id</span><br><span class="line">8.删除容器</span><br><span class="line">	docker rm 容器id</span><br><span class="line">9.启动一个做了端口映射的容器</span><br><span class="line">	docker run --name mytomcat -d -p 8888:8080 tomcat:latest</span><br><span class="line">	-p 将主机的一个端口映射到容器的端口			主机端口:容器内部的端口</span><br><span class="line">10.查看容器日志</span><br><span class="line">	docker logs 容器id</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1577718924925.png" alt="1577718924925"></p>
<p>第9步启动后，通过访问虚拟机IP地址+8888端口，可以查看tomcat是否启动成功</p>
<p><img src="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1577719013811.png" alt="1577719013811"></p>
<p>注意:如果访问tomcat失败，查看linux防火墙状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service firewalld status		查看防火墙状态</span><br><span class="line">service firewalld stop			关闭防火墙</span><br></pre></td></tr></table></figure>



<h2 id="3-安装mysql"><a href="#3-安装mysql" class="headerlink" title="3.安装mysql"></a>3.安装mysql</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line">docker run -p 3306:3306 --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/C:%5CUsers%5Cliujun%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1578315011651.png" alt="1578315011651"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2020/01/06/Docker%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/" data-id="ck6p008260001xwv1263g5bgb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/02/16/SpringCloud%20Config/">SpringCloud Config</a>
          </li>
        
          <li>
            <a href="/2020/02/16/SpringCloud%20Zuul/">SpringCloud Zuul</a>
          </li>
        
          <li>
            <a href="/2020/02/13/SpringCloud%20Hystrix/">SpringCloud Hystrix</a>
          </li>
        
          <li>
            <a href="/2020/02/13/SpringCloud%20Feign/">SpringCloud Feign</a>
          </li>
        
          <li>
            <a href="/2020/02/11/SpringCloud%20Ribbon/">SpringCloud Ribbon</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Damon Liu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>